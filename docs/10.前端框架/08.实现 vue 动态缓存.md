---
title: 实现 vue 动态缓存
date: 2021-05-27 00:00:00
tags: 
  - vue
  - vue3
categories: 
  - vue
permalink: /pages/a2b66cdda89f5/
---

## 第一种方法，利用 keep-alive

思路：

- 给每一个组件的 meta 信息加上字段，这个字段是一个 number 类型，在 APP.vue 监听路由的变化，根据这个字段的比较结果来判断是前进还是后退，如果是前进就把要前进到的页面动态添加到 keep-alive 的数组里面；后退就把当前页面在 keep-alive 数组里面删除。
  问题：
- 但是这种方法不能解决这种情况：进入到用户详情页，点击用户关注列表，进入到新的用户详情页，这时会发现这个新的用户详情页用的还是之前的用户详情页

## 第二种方法，利用 indexedDB

贴一个成熟的操作 indexedDB 的库
https://github.com/localForage/localForage

- 1.在本地设置一个标志用来表示是前进还是后退，默认前进；
- 2.用 indexedDB 设置一个数组用来存储得到的数据，因为 localstoreage 有大小限制，一般为 5m 左右(2.5m 到 10m)
- 3.监听浏览器后退事件，后退就把标志改为后退，同时销毁数组的最后一个数据
- 4.每到一个页面，就根据标志判断是前进到这个页面还是后退到这个页面，如果是前进到这个页面就重新请求数据，把请求到的所有数据 push 存到本地数组；后退就取本地的数组中的最后一个数据展示，同时把标志改为前进

问题注意：

- 1.浏览器刷新后会导致页面默认是前进的，数据会重新请求一份存到数组里，这时候就要给数组里的每个元素设置一个 name，来表示这个数据是给哪个页面用的，在后退到前一个页面，取数组里面的数据作为缓存数据时，要根据 name 来跟当前组件的 name 做比对，比对成功才作为缓存数据，否则就销毁数组的最后一个元素，再取数组的最后一个元素，这样一直重复。

- 2.为了避免存储数据过多，应该做以下操作； - 1）用户可能不会一直回退到首页后再关闭，导致数据存储过多；所以如果项目不会从别的页面点击回到首页，那么每次进入首页存储请求数据后，应该把前面的所有数据清除 - 2）监听浏览器关闭事件，清除所有数组数据（未实现）
