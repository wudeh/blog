(window.webpackJsonp=window.webpackJsonp||[]).push([[87],{611:function(e,a,s){"use strict";s.r(a);var n=s(6),t=Object(n.a)({},(function(){var e=this,a=e.$createElement,s=e._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[s("h3",{attrs:{id:"阿里云cdn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#阿里云cdn"}},[e._v("#")]),e._v(" 阿里云cdn")]),e._v(" "),s("p",[e._v("链接：https://help.aliyun.com/document_detail/209551.htm")]),e._v(" "),s("ul",[s("li",[e._v("将图片托管到阿里云cdn，开通图像处理功能，可以实现自适应WEBP、图片自动旋转（仅自动调正功能）和图片自动瘦身功能。\n主要是可以自动将其他格式的图片转为 webp 图片")]),e._v(" "),s("li",[e._v("在项目中判断当前的浏览器环境支不支持 webp，有3种方法")]),e._v(" "),s("li",[e._v("1.canvas判断方法。可以动态的创建一个canvas对象，通过canvas的toDataURL将设置为webp格式，然后判断\n返回值中是否含有image/webp字段，如果包含则说明支持WebP，反之则不支持。但是尽管大部分浏览器的新版本已经支持webp格式了，然而，toDataURL 出现了滞后，也就是说该方法不能准确的判断浏览器是否支持 webp")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v("function isSupportWebp(){\n const ele = window.document.createElement('canvas')\n if (!!(ele.getContext && ele.getContext('2d'))) {\n   return ele.toDataURL('image/webp').indexOf('webp')>-1\n }\n //不支持canvas,那么一定不支持webp\n return false\n }\n")])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br")])]),s("ul",[s("li",[e._v("2.在服务端根据请求header信息判断浏览器是否支持webp。通过请求头中的accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,"),s("em",[e._v("/")]),e._v(";q=0.8,application/signed-exchange;v=b3;q=0.9;如果有 'image/webp'的话，返回webp格式的图片，否则返回png等格式。")]),e._v(" "),s("li",[e._v("3.宽高判断法。通过创建image对象，将其src属性设置为webp格式的图片，然后在onload事件中获取图片的宽高，如\n果能够获取，则说明浏览器支持webp格式图片。如果不能获取或者触发了onerror函数，那么就说明浏览器不支持webp格\n式的图片。先加载一个webp格式的图片(base64字符串)，如果能获取到width和height，那么是支持webp的，否则是不支持的。\n以下是谷歌官方推荐的方法")])]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('function check_webp_feature(feature, callback) {\n   var kTestImages = {\n       lossy: "UklGRiIAAABXRUJQVlA4IBYAAAAwAQCdASoBAAEADsD+JaQAA3AAAAAA",\n       lossless: "UklGRhoAAABXRUJQVlA4TA0AAAAvAAAAEAcQERGIiP4HAA==",\n       alpha: "UklGRkoAAABXRUJQVlA4WAoAAAAQAAAAAAAAAAAAQUxQSAwAAAARBxAR/Q9ERP8DAABWUDggGAAAABQBAJ0BKgEAAQAAAP4AAA3AAP7mtQAAAA==",\n       animation: "UklGRlIAAABXRUJQVlA4WAoAAAASAAAAAAAAAAAAQU5JTQYAAAD/////AABBTk1GJgAAAAAAAAAAAAAAAAAAAGQAAABWUDhMDQAAAC8AAAAQBxAREYiI/gcA"\n   };\n   var img = new Image();\n   img.onload = function () {\n       var result = (img.width > 0) && (img.height > 0);\n       callback(feature, result);\n   };\n   img.onerror = function () {\n       callback(feature, false);\n   };\n   img.src = "data:image/webp;base64," + kTestImages[feature];\n}\ncheck_webp_feature(\'lossy\', function (feature, isSupported) {\n   if (isSupported) {\n      console.log(\'支持\');\n      console.log(isSupported)\n   }else{\n     console.log(555)\n   }\n});\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br"),s("span",{staticClass:"line-number"},[e._v("5")]),s("br"),s("span",{staticClass:"line-number"},[e._v("6")]),s("br"),s("span",{staticClass:"line-number"},[e._v("7")]),s("br"),s("span",{staticClass:"line-number"},[e._v("8")]),s("br"),s("span",{staticClass:"line-number"},[e._v("9")]),s("br"),s("span",{staticClass:"line-number"},[e._v("10")]),s("br"),s("span",{staticClass:"line-number"},[e._v("11")]),s("br"),s("span",{staticClass:"line-number"},[e._v("12")]),s("br"),s("span",{staticClass:"line-number"},[e._v("13")]),s("br"),s("span",{staticClass:"line-number"},[e._v("14")]),s("br"),s("span",{staticClass:"line-number"},[e._v("15")]),s("br"),s("span",{staticClass:"line-number"},[e._v("16")]),s("br"),s("span",{staticClass:"line-number"},[e._v("17")]),s("br"),s("span",{staticClass:"line-number"},[e._v("18")]),s("br"),s("span",{staticClass:"line-number"},[e._v("19")]),s("br"),s("span",{staticClass:"line-number"},[e._v("20")]),s("br"),s("span",{staticClass:"line-number"},[e._v("21")]),s("br"),s("span",{staticClass:"line-number"},[e._v("22")]),s("br"),s("span",{staticClass:"line-number"},[e._v("23")]),s("br"),s("span",{staticClass:"line-number"},[e._v("24")]),s("br"),s("span",{staticClass:"line-number"},[e._v("25")]),s("br")])]),s("ul",[s("li",[e._v("判断完后，可以将结果保存在本地，下次就不用重复判断，如果浏览器环境支持webp图片，就可以在图片链接后面加上对应参数来加载webp格式图片\n例子：http://example.com/image_01.png?image_process=resize,l_200/rotate,90/format,webp")])]),e._v(" "),s("h3",{attrs:{id:"picture标签"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#picture标签"}},[e._v("#")]),e._v(" picture标签")]),e._v(" "),s("p",[e._v("html5的picture标签，会自动选择最匹配的资源加载。如果支持webp，那么会优先加载webp，否则加载img标签内src路径的资源。\n用这个方法可以使用新的avif格式图片，比 webp 图片更小")]),e._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[e._v('<picture>\n  <source srcset="/path/to/image.webp" type="image/webp">\n  <img src="/path/to/image.jpg" alt="insert alt text here">\n</picture>\n')])]),e._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[e._v("1")]),s("br"),s("span",{staticClass:"line-number"},[e._v("2")]),s("br"),s("span",{staticClass:"line-number"},[e._v("3")]),s("br"),s("span",{staticClass:"line-number"},[e._v("4")]),s("br")])])])}),[],!1,null,null,null);a.default=t.exports}}]);